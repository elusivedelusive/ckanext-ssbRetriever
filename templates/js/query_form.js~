"use strict";

ckan.module('query_form', function($, _) {
    return {
        initialize: function() {

		$('#toggle-query').on('click', function(){
			$('#query-url').toggle();
			$('#query-text').toggle();
		});

		var settings = {
			"async": true,
			"crossdomain": true,
			"url": document.getElementById('query-url').value,
			"method": "POST",
			"headers":{"cache-control": "no-cache"}, //, "Access-Control-Request-Headers":"x-requested-with"
			"dataType": "jsonp",
			"data": document.getElementById('query-text').value
		}

		$('#run-query').on('click', function(){
			
			settings.url = document.getElementById('query-url').value;
			console.log("url: ") + settings.url;
			console.log("query: ") + settings.data;
			//$('#submitButton').toggle();
			$.ajax(settings).done(function(response){
				for(d in JSON.parse(response)){
					
					console.log(d);
				}
			});
		});
        }

    };
});
